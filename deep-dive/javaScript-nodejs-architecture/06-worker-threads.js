/**
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 * NODE.JS ARCHITECTURE - FILE 6: WORKER THREADS
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 *
 * Deep dive into Node.js Worker Threads - true multi-threading in Node.js
 * for CPU-intensive tasks without blocking the main event loop.
 */

console.log("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•");
console.log("       NODE.JS WORKER THREADS - TRUE MULTI-THREADING               ");
console.log("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n");

/**
 * â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
 * â•‘                    WORKER THREADS vs CLUSTER                               â•‘
 * â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
 * â•‘                                                                            â•‘
 * â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â•‘
 * â•‘  â”‚                        CLUSTER MODULE                               â”‚   â•‘
 * â•‘  â”‚                                                                     â”‚   â•‘
 * â•‘  â”‚   Process 1         Process 2         Process 3                    â”‚   â•‘
 * â•‘  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚   â•‘
 * â•‘  â”‚   â”‚   V8    â”‚       â”‚   V8    â”‚       â”‚   V8    â”‚                  â”‚   â•‘
 * â•‘  â”‚   â”‚ Engine  â”‚       â”‚ Engine  â”‚       â”‚ Engine  â”‚                  â”‚   â•‘
 * â•‘  â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                  â”‚   â•‘
 * â•‘  â”‚   â”‚ Memory  â”‚       â”‚ Memory  â”‚       â”‚ Memory  â”‚                  â”‚   â•‘
 * â•‘  â”‚   â”‚  (Own)  â”‚       â”‚  (Own)  â”‚       â”‚  (Own)  â”‚                  â”‚   â•‘
 * â•‘  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚   â•‘
 * â•‘  â”‚                                                                     â”‚   â•‘
 * â•‘  â”‚   â€¢ Separate processes (heavy)                                      â”‚   â•‘
 * â•‘  â”‚   â€¢ No shared memory                                                â”‚   â•‘
 * â•‘  â”‚   â€¢ IPC for communication (slow)                                    â”‚   â•‘
 * â•‘  â”‚   â€¢ Good for: scaling HTTP servers                                  â”‚   â•‘
 * â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â•‘
 * â•‘                                                                            â•‘
 * â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â•‘
 * â•‘  â”‚                       WORKER THREADS                                â”‚   â•‘
 * â•‘  â”‚                                                                     â”‚   â•‘
 * â•‘  â”‚              Single Process                                         â”‚   â•‘
 * â•‘  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚   â•‘
 * â•‘  â”‚   â”‚                                             â”‚                  â”‚   â•‘
 * â•‘  â”‚   â”‚  Thread 1    Thread 2    Thread 3          â”‚                  â”‚   â•‘
 * â•‘  â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”          â”‚                  â”‚   â•‘
 * â•‘  â”‚   â”‚  â”‚  V8  â”‚    â”‚  V8  â”‚    â”‚  V8  â”‚          â”‚                  â”‚   â•‘
 * â•‘  â”‚   â”‚  â”‚ Iso- â”‚    â”‚ Iso- â”‚    â”‚ Iso- â”‚          â”‚                  â”‚   â•‘
 * â•‘  â”‚   â”‚  â”‚ late â”‚    â”‚ late â”‚    â”‚ late â”‚          â”‚                  â”‚   â•‘
 * â•‘  â”‚   â”‚  â””â”€â”€â”¬â”€â”€â”€â”˜    â””â”€â”€â”¬â”€â”€â”€â”˜    â””â”€â”€â”¬â”€â”€â”€â”˜          â”‚                  â”‚   â•‘
 * â•‘  â”‚   â”‚     â”‚           â”‚           â”‚              â”‚                  â”‚   â•‘
 * â•‘  â”‚   â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚                  â”‚   â•‘
 * â•‘  â”‚   â”‚                 â–¼                          â”‚                  â”‚   â•‘
 * â•‘  â”‚   â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚                  â”‚   â•‘
 * â•‘  â”‚   â”‚      â”‚   SharedArrayBuffer â”‚               â”‚                  â”‚   â•‘
 * â•‘  â”‚   â”‚      â”‚   (Shared Memory)   â”‚               â”‚                  â”‚   â•‘
 * â•‘  â”‚   â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚                  â”‚   â•‘
 * â•‘  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚   â•‘
 * â•‘  â”‚                                                                     â”‚   â•‘
 * â•‘  â”‚   â€¢ True threads (lightweight)                                      â”‚   â•‘
 * â•‘  â”‚   â€¢ Can share memory (SharedArrayBuffer)                            â”‚   â•‘
 * â•‘  â”‚   â€¢ Fast communication (postMessage)                                â”‚   â•‘
 * â•‘  â”‚   â€¢ Good for: CPU-intensive tasks                                   â”‚   â•‘
 * â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â•‘
 * â•‘                                                                            â•‘
 * â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 */

const {
  Worker,
  isMainThread,
  parentPort,
  workerData,
  MessageChannel,
  threadId
} = require('worker_threads');

console.log("1ï¸âƒ£  CLUSTER vs WORKER THREADS COMPARISON\n");

console.log(`
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    CLUSTER vs WORKER THREADS                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Feature           â”‚  Cluster Module        â”‚  Worker Threads               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Type              â”‚  Multiple processes    â”‚  Multiple threads             â”‚
â”‚  Memory            â”‚  Separate (isolated)   â”‚  Can share (SharedArrayBuffer)â”‚
â”‚  Communication     â”‚  IPC (serialization)   â”‚  postMessage or SharedMemory  â”‚
â”‚  Startup cost      â”‚  Heavy (fork process)  â”‚  Lighter (new thread)         â”‚
â”‚  V8 instances      â”‚  One per process       â”‚  One per thread (V8 Isolate)  â”‚
â”‚  Event loop        â”‚  One per process       â”‚  One per thread               â”‚
â”‚  Use case          â”‚  Scale HTTP servers    â”‚  CPU-intensive computation    â”‚
â”‚  Overhead          â”‚  Higher                â”‚  Lower                        â”‚
â”‚  Fault isolation   â”‚  Complete              â”‚  Partial (same process)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
`);


/**
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 *                        BASIC WORKER THREAD
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 */

console.log("â•".repeat(70));
console.log("2ï¸âƒ£  BASIC WORKER THREAD EXAMPLE\n");

/**
 * â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 * â”‚                    WORKER THREAD LIFECYCLE                                 â”‚
 * â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 * â”‚                                                                            â”‚
 * â”‚   Main Thread                          Worker Thread                       â”‚
 * â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                          â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                       â”‚
 * â”‚        â”‚                                                                   â”‚
 * â”‚        â”‚  new Worker('file.js')                                           â”‚
 * â”‚        â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                               â”‚
 * â”‚        â”‚                                  â”‚ Execute script                â”‚
 * â”‚        â”‚                                  â”‚                               â”‚
 * â”‚        â”‚â—„â”€â”€â”€â”€ 'online' event â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                               â”‚
 * â”‚        â”‚                                  â”‚                               â”‚
 * â”‚        â”‚  worker.postMessage(data)        â”‚                               â”‚
 * â”‚        â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                               â”‚
 * â”‚        â”‚                                  â”‚ parentPort.on('message')      â”‚
 * â”‚        â”‚                                  â”‚                               â”‚
 * â”‚        â”‚â—„â”€â”€ parentPort.postMessage(res) â”€â”€â”‚                               â”‚
 * â”‚        â”‚  worker.on('message')            â”‚                               â”‚
 * â”‚        â”‚                                  â”‚                               â”‚
 * â”‚        â”‚â—„â”€â”€â”€â”€ 'exit' event â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                               â”‚
 * â”‚        â”‚                                  â”‚                               â”‚
 * â”‚        â–¼                                  â–¼                               â”‚
 * â”‚                                                                            â”‚
 * â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
 */

// Example: Inline Worker (using eval)
console.log("=== Basic Worker Thread Demo ===\n");

// Inline worker code for demonstration
const workerCode = `
  const { parentPort, workerData } = require('worker_threads');

  // Receive initial data
  console.log('Worker started with data:', workerData);

  // Simulate CPU-intensive work
  function fibonacci(n) {
    if (n <= 1) return n;
    return fibonacci(n - 1) + fibonacci(n - 2);
  }

  // Listen for messages
  parentPort.on('message', (n) => {
    console.log('Worker computing fibonacci(' + n + ')...');
    const result = fibonacci(n);
    parentPort.postMessage({ n, result });
  });
`;

// Note: In real code, worker code would be in a separate file
console.log(`
// main.js - Main Thread
const { Worker } = require('worker_threads');

// Create worker from file
const worker = new Worker('./worker.js', {
  workerData: { initialValue: 42 }
});

// Handle messages from worker
worker.on('message', (result) => {
  console.log('Result from worker:', result);
});

// Handle errors
worker.on('error', (err) => {
  console.error('Worker error:', err);
});

// Handle exit
worker.on('exit', (code) => {
  console.log('Worker exited with code:', code);
});

// Send task to worker
worker.postMessage(40); // Calculate fibonacci(40)

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

// worker.js - Worker Thread
const { parentPort, workerData } = require('worker_threads');

console.log('Worker started with:', workerData);

function fibonacci(n) {
  if (n <= 1) return n;
  return fibonacci(n - 1) + fibonacci(n - 2);
}

parentPort.on('message', (n) => {
  const result = fibonacci(n);
  parentPort.postMessage({ n, result });
});
`);


/**
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 *                        WORKER DATA PASSING
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 */

console.log("\n" + "â•".repeat(70));
console.log("3ï¸âƒ£  DATA PASSING METHODS\n");

/**
 * â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 * â”‚                    DATA PASSING METHODS                                    â”‚
 * â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 * â”‚                                                                            â”‚
 * â”‚  1. workerData (one-time, at creation)                                    â”‚
 * â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                 â”‚
 * â”‚     â”‚   Main     â”‚ â”€â”€â”€â”€â”€â”€â–º â”‚   Worker   â”‚                                 â”‚
 * â”‚     â”‚   Thread   â”‚ Clone   â”‚   Thread   â”‚                                 â”‚
 * â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                 â”‚
 * â”‚     Data is cloned (structured clone algorithm)                           â”‚
 * â”‚                                                                            â”‚
 * â”‚  2. postMessage (bidirectional, anytime)                                  â”‚
 * â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â—„â”€â”€â”€â”€â”€â–º â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                 â”‚
 * â”‚     â”‚   Main     â”‚ Clone   â”‚   Worker   â”‚                                 â”‚
 * â”‚     â”‚   Thread   â”‚         â”‚   Thread   â”‚                                 â”‚
 * â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                 â”‚
 * â”‚     Data is cloned (serialization cost)                                   â”‚
 * â”‚                                                                            â”‚
 * â”‚  3. SharedArrayBuffer (shared memory)                                     â”‚
 * â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                 â”‚
 * â”‚     â”‚   Main     â”‚         â”‚   Worker   â”‚                                 â”‚
 * â”‚     â”‚   Thread   â”‚         â”‚   Thread   â”‚                                 â”‚
 * â”‚     â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                 â”‚
 * â”‚           â”‚                      â”‚                                         â”‚
 * â”‚           â””â”€â”€â”€â”€â”€â”€â”€â–ºâ”Œâ”€â”€â”€â”€â”â—„â”€â”€â”€â”€â”€â”€â”€â”˜                                        â”‚
 * â”‚                    â”‚SAB â”‚  (Zero-copy, same memory!)                      â”‚
 * â”‚                    â””â”€â”€â”€â”€â”˜                                                 â”‚
 * â”‚                                                                            â”‚
 * â”‚  4. Transferable Objects (transfer ownership)                             â”‚
 * â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                 â”‚
 * â”‚     â”‚   Main     â”‚ â”€â”€â”€â”€â”€â”€â–º â”‚   Worker   â”‚                                 â”‚
 * â”‚     â”‚  (loses    â”‚ Move    â”‚  (gains    â”‚                                 â”‚
 * â”‚     â”‚   access)  â”‚         â”‚   access)  â”‚                                 â”‚
 * â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                 â”‚
 * â”‚     ArrayBuffer becomes unusable in sender                                â”‚
 * â”‚                                                                            â”‚
 * â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
 */

console.log(`
// Method 1: workerData (initial data)
const worker = new Worker('./worker.js', {
  workerData: {
    config: { timeout: 5000 },
    items: [1, 2, 3]
  }
});

// In worker:
// const { workerData } = require('worker_threads');
// console.log(workerData.config); // { timeout: 5000 }

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

// Method 2: postMessage (ongoing communication)
// Main thread:
worker.postMessage({ type: 'task', data: [1, 2, 3] });

// Worker thread:
// parentPort.on('message', (msg) => {
//   if (msg.type === 'task') processTask(msg.data);
// });

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

// Method 3: SharedArrayBuffer (shared memory)
const sharedBuffer = new SharedArrayBuffer(1024);
const view = new Int32Array(sharedBuffer);

const worker = new Worker('./worker.js', {
  workerData: { sharedBuffer }
});

// Both threads see the SAME memory!
view[0] = 42; // Worker can also read this as 42

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

// Method 4: Transferable Objects (zero-copy transfer)
const buffer = new ArrayBuffer(1024 * 1024); // 1MB

worker.postMessage(buffer, [buffer]); // Transfer ownership
// buffer.byteLength is now 0! (detached)

// Worker receives the actual buffer (no copy)
`);


/**
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 *                        SHARED ARRAY BUFFER
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 */

console.log("â•".repeat(70));
console.log("4ï¸âƒ£  SHAREDARRAY BUFFER - SHARED MEMORY\n");

/**
 * â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 * â”‚                    SHAREDARRAY BUFFER ARCHITECTURE                         â”‚
 * â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 * â”‚                                                                            â”‚
 * â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
 * â”‚   â”‚                     Shared Memory Region                        â”‚      â”‚
 * â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”    â”‚      â”‚
 * â”‚   â”‚  â”‚  0   â”‚  1   â”‚  2   â”‚  3   â”‚  4   â”‚  5   â”‚  6   â”‚  7   â”‚    â”‚      â”‚
 * â”‚   â”‚  â”‚ byte â”‚ byte â”‚ byte â”‚ byte â”‚ byte â”‚ byte â”‚ byte â”‚ byte â”‚    â”‚      â”‚
 * â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”˜    â”‚      â”‚
 * â”‚   â”‚              â–²                           â–²                      â”‚      â”‚
 * â”‚   â”‚              â”‚                           â”‚                      â”‚      â”‚
 * â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
 * â”‚                  â”‚                           â”‚                             â”‚
 * â”‚    Main Thread   â”‚            Worker Thread  â”‚                             â”‚
 * â”‚    Int32Arrayâ”€â”€â”€â”€â”˜            Int32Arrayâ”€â”€â”€â”€â”€â”˜                             â”‚
 * â”‚    (view)                     (view)                                       â”‚
 * â”‚                                                                            â”‚
 * â”‚   âš ï¸ WARNING: Race conditions possible!                                   â”‚
 * â”‚   Use Atomics API for thread-safe operations                              â”‚
 * â”‚                                                                            â”‚
 * â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
 */

console.log(`
// SharedArrayBuffer Example

// Main thread
const sharedBuffer = new SharedArrayBuffer(4 * Int32Array.BYTES_PER_ELEMENT);
const sharedArray = new Int32Array(sharedBuffer);

// Initialize values
sharedArray[0] = 0; // counter
sharedArray[1] = 0; // status: 0=idle, 1=working, 2=done

const worker = new Worker(\`
  const { workerData, parentPort } = require('worker_threads');
  const sharedArray = new Int32Array(workerData.sharedBuffer);

  // Signal working
  Atomics.store(sharedArray, 1, 1);

  // Increment counter 1000 times
  for (let i = 0; i < 1000; i++) {
    Atomics.add(sharedArray, 0, 1);
  }

  // Signal done
  Atomics.store(sharedArray, 1, 2);
  parentPort.postMessage('done');
\`, { eval: true, workerData: { sharedBuffer } });

worker.on('message', () => {
  console.log('Counter value:', Atomics.load(sharedArray, 0)); // 1000
});
`);


/**
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 *                        ATOMICS API
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 */

console.log("\n" + "â•".repeat(70));
console.log("5ï¸âƒ£  ATOMICS API - THREAD-SAFE OPERATIONS\n");

/**
 * â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 * â”‚                    ATOMICS - PREVENTING RACE CONDITIONS                    â”‚
 * â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 * â”‚                                                                            â”‚
 * â”‚   WITHOUT Atomics (Race Condition):                                       â”‚
 * â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
 * â”‚   â”‚  Thread A              Shared Memory         Thread B            â”‚    â”‚
 * â”‚   â”‚     â”‚                     counter=0             â”‚                â”‚    â”‚
 * â”‚   â”‚     â”‚  read(0)  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º                   â”‚                â”‚    â”‚
 * â”‚   â”‚     â”‚                            â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ read(0)        â”‚    â”‚
 * â”‚   â”‚     â”‚  write(1) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º                   â”‚                â”‚    â”‚
 * â”‚   â”‚     â”‚                  counter=1                â”‚                â”‚    â”‚
 * â”‚   â”‚     â”‚                            â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ write(1)       â”‚    â”‚
 * â”‚   â”‚     â”‚                  counter=1  â† WRONG!      â”‚                â”‚    â”‚
 * â”‚   â”‚     â”‚                  Expected 2               â”‚                â”‚    â”‚
 * â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
 * â”‚                                                                            â”‚
 * â”‚   WITH Atomics (Thread-Safe):                                             â”‚
 * â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
 * â”‚   â”‚  Thread A              Shared Memory         Thread B            â”‚    â”‚
 * â”‚   â”‚     â”‚                     counter=0             â”‚                â”‚    â”‚
 * â”‚   â”‚     â”‚  Atomics.add(+1) â”€â”€â–ºâ”‚                     â”‚ BLOCKED        â”‚    â”‚
 * â”‚   â”‚     â”‚                  counter=1                â”‚    â”‚           â”‚    â”‚
 * â”‚   â”‚     â”‚                     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ Atomics.add(+1)â”‚    â”‚
 * â”‚   â”‚     â”‚                  counter=2  â† CORRECT!                     â”‚    â”‚
 * â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
 * â”‚                                                                            â”‚
 * â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
 */

console.log(`
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ATOMICS API METHODS                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  Read/Write Operations:                                                      â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                       â”‚
â”‚  Atomics.load(array, index)                  // Atomic read                  â”‚
â”‚  Atomics.store(array, index, value)          // Atomic write                 â”‚
â”‚  Atomics.exchange(array, index, value)       // Set and return old value    â”‚
â”‚                                                                              â”‚
â”‚  Arithmetic Operations:                                                      â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                      â”‚
â”‚  Atomics.add(array, index, value)            // Add and return old value    â”‚
â”‚  Atomics.sub(array, index, value)            // Subtract and return old     â”‚
â”‚                                                                              â”‚
â”‚  Bitwise Operations:                                                         â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                          â”‚
â”‚  Atomics.and(array, index, value)            // Bitwise AND                  â”‚
â”‚  Atomics.or(array, index, value)             // Bitwise OR                   â”‚
â”‚  Atomics.xor(array, index, value)            // Bitwise XOR                  â”‚
â”‚                                                                              â”‚
â”‚  Compare and Swap:                                                           â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                            â”‚
â”‚  Atomics.compareExchange(arr, i, expected, replacement)                      â”‚
â”‚  // If arr[i] === expected, set to replacement, return old value            â”‚
â”‚                                                                              â”‚
â”‚  Wait/Notify (Synchronization):                                              â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                               â”‚
â”‚  Atomics.wait(array, index, value, timeout)  // Block until value changes   â”‚
â”‚  Atomics.notify(array, index, count)         // Wake waiting threads        â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
`);

// Demonstrate Atomics
console.log("=== Atomics Demo ===\n");

const sab = new SharedArrayBuffer(Int32Array.BYTES_PER_ELEMENT);
const arr = new Int32Array(sab);

console.log("Initial value:", Atomics.load(arr, 0));

Atomics.store(arr, 0, 10);
console.log("After store(10):", Atomics.load(arr, 0));

const oldVal = Atomics.add(arr, 0, 5);
console.log("After add(5), old value was:", oldVal);
console.log("New value:", Atomics.load(arr, 0));

const swapped = Atomics.compareExchange(arr, 0, 15, 100);
console.log("compareExchange(15, 100), returned:", swapped);
console.log("Value after compareExchange:", Atomics.load(arr, 0));


/**
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 *                        WORKER THREAD POOL
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 */

console.log("\n" + "â•".repeat(70));
console.log("6ï¸âƒ£  WORKER THREAD POOL PATTERN\n");

/**
 * â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 * â”‚                    WORKER THREAD POOL                                      â”‚
 * â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 * â”‚                                                                            â”‚
 * â”‚                          Main Thread                                       â”‚
 * â”‚                              â”‚                                             â”‚
 * â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                  â”‚
 * â”‚                    â”‚    Task Queue     â”‚                                  â”‚
 * â”‚                    â”‚ [T1][T2][T3][T4]  â”‚                                  â”‚
 * â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                  â”‚
 * â”‚                              â”‚ Distribute                                  â”‚
 * â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
 * â”‚          â”‚                   â”‚                   â”‚                        â”‚
 * â”‚          â–¼                   â–¼                   â–¼                        â”‚
 * â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
 * â”‚   â”‚  Worker 1  â”‚      â”‚  Worker 2  â”‚      â”‚  Worker 3  â”‚                 â”‚
 * â”‚   â”‚            â”‚      â”‚            â”‚      â”‚            â”‚                 â”‚
 * â”‚   â”‚ Processing â”‚      â”‚    Idle    â”‚      â”‚ Processing â”‚                 â”‚
 * â”‚   â”‚    T1      â”‚      â”‚            â”‚      â”‚    T3      â”‚                 â”‚
 * â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
 * â”‚                                                                            â”‚
 * â”‚   Benefits:                                                                â”‚
 * â”‚   â€¢ Reuse workers (avoid creation overhead)                               â”‚
 * â”‚   â€¢ Limit concurrency (prevent resource exhaustion)                       â”‚
 * â”‚   â€¢ Queue management (handle bursts)                                      â”‚
 * â”‚                                                                            â”‚
 * â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
 */

console.log(`
// Worker Thread Pool Implementation

const { Worker } = require('worker_threads');
const os = require('os');

class WorkerPool {
  constructor(workerScript, poolSize = os.cpus().length) {
    this.workerScript = workerScript;
    this.poolSize = poolSize;
    this.workers = [];
    this.freeWorkers = [];
    this.taskQueue = [];

    // Initialize workers
    for (let i = 0; i < poolSize; i++) {
      this.addNewWorker();
    }
  }

  addNewWorker() {
    const worker = new Worker(this.workerScript);

    worker.on('message', (result) => {
      // Task completed
      worker.currentResolve(result);
      worker.currentResolve = null;
      worker.currentReject = null;

      // Process next task if available
      if (this.taskQueue.length > 0) {
        const { task, resolve, reject } = this.taskQueue.shift();
        this.runTask(worker, task, resolve, reject);
      } else {
        this.freeWorkers.push(worker);
      }
    });

    worker.on('error', (err) => {
      if (worker.currentReject) {
        worker.currentReject(err);
      }
      // Replace crashed worker
      this.workers = this.workers.filter(w => w !== worker);
      this.addNewWorker();
    });

    this.workers.push(worker);
    this.freeWorkers.push(worker);
  }

  runTask(worker, task, resolve, reject) {
    worker.currentResolve = resolve;
    worker.currentReject = reject;
    worker.postMessage(task);
  }

  exec(task) {
    return new Promise((resolve, reject) => {
      if (this.freeWorkers.length > 0) {
        const worker = this.freeWorkers.pop();
        this.runTask(worker, task, resolve, reject);
      } else {
        // Queue the task
        this.taskQueue.push({ task, resolve, reject });
      }
    });
  }

  async destroy() {
    for (const worker of this.workers) {
      await worker.terminate();
    }
  }
}

// Usage:
const pool = new WorkerPool('./cpu-intensive-worker.js', 4);

// Execute tasks
const results = await Promise.all([
  pool.exec({ type: 'fibonacci', n: 40 }),
  pool.exec({ type: 'fibonacci', n: 41 }),
  pool.exec({ type: 'fibonacci', n: 42 }),
  pool.exec({ type: 'fibonacci', n: 43 }),
]);

await pool.destroy();
`);


/**
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 *                    MESSAGE CHANNEL
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 */

console.log("\n" + "â•".repeat(70));
console.log("7ï¸âƒ£  MESSAGE CHANNEL - DIRECT WORKER COMMUNICATION\n");

/**
 * â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 * â”‚                    MESSAGE CHANNEL                                         â”‚
 * â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
 * â”‚                                                                            â”‚
 * â”‚   Without MessageChannel:                                                  â”‚
 * â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
 * â”‚   â”‚Worker 1â”‚ â”€â”€â”€â”€â”€â”€â–º â”‚  Main  â”‚ â”€â”€â”€â”€â”€â”€â–º â”‚Worker 2â”‚                        â”‚
 * â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
 * â”‚   All messages go through main thread                                     â”‚
 * â”‚                                                                            â”‚
 * â”‚   With MessageChannel:                                                     â”‚
 * â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
 * â”‚   â”‚Worker 1â”‚       Direct Link          â”‚Worker 2â”‚                        â”‚
 * â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
 * â”‚   Workers communicate directly!                                           â”‚
 * â”‚                                                                            â”‚
 * â”‚   MessageChannel creates two connected MessagePorts:                       â”‚
 * â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
 * â”‚   â”‚  const { port1, port2 } = new MessageChannel();  â”‚                    â”‚
 * â”‚   â”‚                                                   â”‚                    â”‚
 * â”‚   â”‚  port1.postMessage() â”€â”€â”€â”€â”€â”€â–º port2.on('message') â”‚                    â”‚
 * â”‚   â”‚  port1.on('message') â—„â”€â”€â”€â”€â”€â”€ port2.postMessage() â”‚                    â”‚
 * â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
 * â”‚                                                                            â”‚
 * â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
 */

console.log(`
// Direct Worker-to-Worker Communication

const { Worker, MessageChannel } = require('worker_threads');

// Create channel
const { port1, port2 } = new MessageChannel();

// Worker 1 - Producer
const producer = new Worker(\`
  const { parentPort } = require('worker_threads');

  parentPort.once('message', (port) => {
    // Send data directly to consumer
    for (let i = 0; i < 10; i++) {
      port.postMessage({ item: i });
    }
    port.postMessage({ done: true });
  });
\`, { eval: true });

// Worker 2 - Consumer
const consumer = new Worker(\`
  const { parentPort } = require('worker_threads');

  parentPort.once('message', (port) => {
    port.on('message', (msg) => {
      if (msg.done) {
        console.log('Consumer: All items received');
      } else {
        console.log('Consumer received:', msg.item);
      }
    });
  });
\`, { eval: true });

// Transfer ports to workers
producer.postMessage(port1, [port1]);
consumer.postMessage(port2, [port2]);

// Now workers communicate directly without going through main!
`);


/**
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 *                    USE CASES
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 */

console.log("â•".repeat(70));
console.log("8ï¸âƒ£  WHEN TO USE WORKER THREADS\n");

console.log(`
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    WHEN TO USE WORKER THREADS                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  âœ… GOOD Use Cases:                                                         â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                           â”‚
â”‚  â€¢ Image/Video processing (encoding, resizing, filters)                     â”‚
â”‚  â€¢ Cryptographic operations (hashing, encryption)                           â”‚
â”‚  â€¢ Data compression/decompression                                           â”‚
â”‚  â€¢ Mathematical computations (scientific, ML inference)                     â”‚
â”‚  â€¢ Parsing large files (JSON, XML, CSV)                                     â”‚
â”‚  â€¢ Code compilation/transpilation                                           â”‚
â”‚  â€¢ PDF generation                                                           â”‚
â”‚                                                                              â”‚
â”‚  âŒ BAD Use Cases (use other approaches):                                   â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                    â”‚
â”‚  â€¢ I/O operations (already async via event loop)                            â”‚
â”‚  â€¢ HTTP request handling (use Cluster for scaling)                          â”‚
â”‚  â€¢ Database queries (already non-blocking)                                  â”‚
â”‚  â€¢ File system operations (use streams)                                     â”‚
â”‚  â€¢ Simple quick computations (overhead not worth it)                        â”‚
â”‚                                                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  Rule of Thumb:                                                              â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                               â”‚
â”‚  If a computation takes > 10-50ms and blocks the event loop,                â”‚
â”‚  consider moving it to a Worker Thread.                                     â”‚
â”‚                                                                              â”‚
â”‚  If the task is I/O-bound, the event loop handles it efficiently already.   â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
`);


/**
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 *                        INTERVIEW QUESTIONS
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 */

console.log("â•".repeat(70));
console.log("ğŸ“‹  WORKER THREADS - INTERVIEW QUESTIONS\n");

console.log(`
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Q1: What's the difference between Cluster and Worker Threads?               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ A: Cluster:                                                                  â”‚
â”‚    â€¢ Creates separate processes (heavy, isolated)                           â”‚
â”‚    â€¢ No shared memory                                                       â”‚
â”‚    â€¢ Communication via IPC (serialization required)                         â”‚
â”‚    â€¢ Best for: scaling HTTP servers across CPU cores                        â”‚
â”‚                                                                              â”‚
â”‚    Worker Threads:                                                           â”‚
â”‚    â€¢ Creates threads within same process (lighter)                          â”‚
â”‚    â€¢ Can share memory via SharedArrayBuffer                                 â”‚
â”‚    â€¢ Faster communication (can use shared memory)                           â”‚
â”‚    â€¢ Best for: CPU-intensive operations, offloading computation             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Q2: How do Worker Threads share memory?                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ A: Using SharedArrayBuffer:                                                  â”‚
â”‚                                                                              â”‚
â”‚    1. Create SharedArrayBuffer in main thread                               â”‚
â”‚    2. Pass it to worker via workerData or postMessage                       â”‚
â”‚    3. Both threads see the same memory                                      â”‚
â”‚                                                                              â”‚
â”‚    const sab = new SharedArrayBuffer(1024);                                 â”‚
â”‚    const worker = new Worker('file.js', { workerData: { sab } });           â”‚
â”‚                                                                              â”‚
â”‚    âš ï¸ Must use Atomics API for thread-safe operations!                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Q3: What is the Atomics API and why is it needed?                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ A: Atomics provides atomic (indivisible) operations on SharedArrayBuffer.   â”‚
â”‚                                                                              â”‚
â”‚    Without Atomics: Race conditions can occur when multiple threads         â”‚
â”‚    read/write shared memory simultaneously.                                 â”‚
â”‚                                                                              â”‚
â”‚    Atomics.add(), Atomics.load(), Atomics.store() etc. guarantee that       â”‚
â”‚    the operation completes without interruption from other threads.         â”‚
â”‚                                                                              â”‚
â”‚    Atomics.wait() and Atomics.notify() provide synchronization primitives   â”‚
â”‚    similar to mutex/condition variables in other languages.                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Q4: What happens when you transfer an ArrayBuffer to a worker?              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ A: The buffer is moved (not copied):                                        â”‚
â”‚                                                                              â”‚
â”‚    worker.postMessage(buffer, [buffer]); // Second arg = transfer list     â”‚
â”‚                                                                              â”‚
â”‚    After transfer:                                                           â”‚
â”‚    â€¢ Main thread's buffer is "detached" (byteLength becomes 0)             â”‚
â”‚    â€¢ Worker receives the actual buffer (zero-copy)                          â”‚
â”‚    â€¢ Very efficient for large data                                          â”‚
â”‚                                                                              â”‚
â”‚    Without transfer (just postMessage):                                     â”‚
â”‚    â€¢ Buffer is cloned (memory copied)                                       â”‚
â”‚    â€¢ Both threads have their own copy                                       â”‚
â”‚    â€¢ Slower for large data                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Q5: When should you NOT use Worker Threads?                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ A: â€¢ I/O operations - Event loop already handles async I/O efficiently     â”‚
â”‚    â€¢ Database queries - Already non-blocking                                â”‚
â”‚    â€¢ HTTP handling - Use Cluster instead for scaling                        â”‚
â”‚    â€¢ Quick operations - Thread creation overhead not worth it               â”‚
â”‚                                                                              â”‚
â”‚    Worker threads add complexity. Only use when:                            â”‚
â”‚    â€¢ Computation blocks event loop (>10-50ms)                               â”‚
â”‚    â€¢ Task is CPU-bound, not I/O-bound                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Q6: Does each Worker Thread have its own event loop?                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ A: Yes! Each worker thread has:                                              â”‚
â”‚    â€¢ Its own V8 isolate (separate JS engine instance)                       â”‚
â”‚    â€¢ Its own event loop                                                     â”‚
â”‚    â€¢ Its own libuv thread pool                                              â”‚
â”‚    â€¢ Separate JavaScript heap                                               â”‚
â”‚                                                                              â”‚
â”‚    But they share:                                                           â”‚
â”‚    â€¢ Process (same PID)                                                     â”‚
â”‚    â€¢ Some libuv resources                                                   â”‚
â”‚    â€¢ SharedArrayBuffer memory (if passed)                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
`);


/**
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 *                           CHEAT SHEET
 * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 */

console.log("â•".repeat(70));
console.log("ğŸ“  WORKER THREADS CHEAT SHEET\n");

console.log(`
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                     WORKER THREADS QUICK REFERENCE                         â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                            â•‘
â•‘  Core Imports:                                                             â•‘
â•‘    const {                                                                 â•‘
â•‘      Worker,              // Create worker                                 â•‘
â•‘      isMainThread,        // true in main thread                           â•‘
â•‘      parentPort,          // Communication port (in worker)                â•‘
â•‘      workerData,          // Initial data (in worker)                      â•‘
â•‘      threadId,            // Current thread ID                             â•‘
â•‘      MessageChannel       // Direct thread communication                   â•‘
â•‘    } = require('worker_threads');                                          â•‘
â•‘                                                                            â•‘
â•‘  Create Worker:                                                            â•‘
â•‘    new Worker('./file.js')                                                 â•‘
â•‘    new Worker('./file.js', { workerData: {...} })                          â•‘
â•‘    new Worker(code, { eval: true })  // Inline code                        â•‘
â•‘                                                                            â•‘
â•‘  Main â†’ Worker Communication:                                              â•‘
â•‘    worker.postMessage(data)          // Send to worker                     â•‘
â•‘    worker.on('message', cb)          // Receive from worker                â•‘
â•‘                                                                            â•‘
â•‘  Worker â†’ Main Communication:                                              â•‘
â•‘    parentPort.postMessage(data)      // Send to main                       â•‘
â•‘    parentPort.on('message', cb)      // Receive from main                  â•‘
â•‘                                                                            â•‘
â•‘  Transfer (zero-copy):                                                     â•‘
â•‘    worker.postMessage(buf, [buf])    // Transfer ArrayBuffer               â•‘
â•‘                                                                            â•‘
â•‘  Worker Events:                                                            â•‘
â•‘    'online'   // Worker started                                            â•‘
â•‘    'message'  // Message received                                          â•‘
â•‘    'error'    // Uncaught error                                            â•‘
â•‘    'exit'     // Worker exited                                             â•‘
â•‘                                                                            â•‘
â•‘  Terminate:                                                                â•‘
â•‘    await worker.terminate()          // Graceful termination               â•‘
â•‘                                                                            â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                       ATOMICS QUICK REFERENCE                              â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                            â•‘
â•‘  Read/Write:                                                               â•‘
â•‘    Atomics.load(arr, idx)                    // Read value                 â•‘
â•‘    Atomics.store(arr, idx, val)              // Write value                â•‘
â•‘                                                                            â•‘
â•‘  Arithmetic:                                                               â•‘
â•‘    Atomics.add(arr, idx, val)                // Add and return old         â•‘
â•‘    Atomics.sub(arr, idx, val)                // Subtract and return old    â•‘
â•‘                                                                            â•‘
â•‘  Compare-and-Swap:                                                         â•‘
â•‘    Atomics.compareExchange(arr, idx, expected, newVal)                     â•‘
â•‘                                                                            â•‘
â•‘  Synchronization:                                                          â•‘
â•‘    Atomics.wait(arr, idx, val, timeout)      // Block until changed        â•‘
â•‘    Atomics.notify(arr, idx, count)           // Wake waiters               â•‘
â•‘                                                                            â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
`);

console.log("\nâ•â•â• FILE 6 COMPLETE â•â•â•");
console.log("Run: node 07-child-processes.js");
